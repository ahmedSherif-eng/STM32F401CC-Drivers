/*AUTHOR  : AHMED SHERIF
MICRO   : STM32F401CCU6
LAYER   : MCAL
DRIVER  : SYSTICK
File    :  SYSTICK.c
Version :1.0
********************************************************************************************************
*********************************************************/



/*******************************************   Includes    ***********************************************
 *********************************************************************************************************/

#include"../../LIB/STD_TYPES.h"
#include"../../LIB/BIT_MATHS.h"
#include"STK_private.h"
#include"STK_interface.h"
#include"STK_config.h"



/*********************************************************************************************************
 *********************************************************************************************************/



/*******************************************   APIS    ***********************************************
 *********************************************************************************************************/
void STK_voidInit(void)
{
	#if CLK_SOURCE == CLK_AHB
		SET_BIT(STK->CTRL,CLKSOURCE);
	#elif	CLK_SOURCE == CLK_AHB/8
		CLEAR_BIT(STK->CTRL,CLKSOURCE);

	#else
		#error "Wrong Clock Source mode"
	#endif

	#if INTERRUPT_STATE == INT
		SET_BIT(STK->CTRL,TICKINT);
	#elif INTERRUPT_STATE == NO_INT
		CLEAR_BIT(STK->CTRL,TICKINT);
	#else
		#error "Wrong Interrupt mode"
	#endif
}


/*********************************************************************************************************
 *********************************************************************************************************/



void STK_voidStart(u32 copy_u32Load_Value)
{
	STK->LOAD=copy_u32Load_Value;
	SET_BIT(STK->CTRL,ENABLE);
}

/*********************************************************************************************************
 *********************************************************************************************************/



u32 STK_u32ElapsedTime()
{
	return(STK->LOAD)-(STK->VAL);
}



/*********************************************************************************************************
 *********************************************************************************************************/
u32  STK_u32RemainingTime()
{
	return (STK->VAL)+1;
}


/*********************************************************************************************************
 *********************************************************************************************************/
u8	 STK_u8ReadFlag()
{
	return GET_BIT(STK->CTRL,COUNTFLAG);
}


/*********************************************************************************************************
 *********************************************************************************************************/




void STK_voidTimeDelay_ms(u32 copy_u32Delay_ms)
{
	f32 tickTime;
	#if CLK_SOURCE == CLK_AHB
		tickTime=1/F_CPU;
	#elif
		tickTime=8/F_CPU
	#endif
	f32 timeInSeconds = copy_u32Delay_ms/1000;
	u32 numberOfTicks =timeInSeconds/tickTime ;
	STK->LOAD= numberOfTicks-1;
	while(!GET_BIT(STK->CTRL,COUNTFLAG));
}




/*********************************************************************************************************
 *********************************************************************************************************/



void STK_voidTimeDelay_us(u32 copy_u32Delay_us)
{
	f32 tickTime;
	#if CLK_SOURCE == CLK_AHB
		tickTime=1/F_CPU;
	#elif
		tickTime=8/F_CPU
	#endif
	f32 timeInSeconds = copy_u32Delay_us/10000;
	u32 numberOfTicks =timeInSeconds/tickTime ;
	STK->LOAD= numberOfTicks-1;
	while(!GET_BIT(STK->CTRL,COUNTFLAG));

}




/************************************************END OF FILE ********************************************************
 *********************************************************************************************************/
